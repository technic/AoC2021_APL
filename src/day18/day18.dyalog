⎕IO←0
a←{⍎('\[' ',' '\]'⎕R{⍵.PatternNum⌷'( )'})⍵}¨⊃⎕NGET'day18/input.txt'1
push←{⊂⍺{s v←⍺ ⋄ 0=≡⍵:⍵+v ⋄ (⊂⍺)∇¨@s⊢⍵}⊃⍵}
explode←{0=≡⍵:(0 0)⍵ ⋄ 1=≡⍵:⍺{⍺>3:⍵ 0 ⋄ (0 0)⍵}⍵ ⋄ e v←(⍺+1)∇0⊃⍵ ⋄ ~v≡0⊃⍵:(⊂1 0×e),⊂0(1⊃e)push@1⊢(⊂v)@0⊢⍵ ⋄ e v←(⍺+1)∇1⊃⍵ ⋄ (⊂0 1×e),⊂1(0⊃e)push@0⊢(⊂v)@1⊢⍵}
split←{0=≡⍵:{⍵≥10:(⌊2÷⍨⍵)(⌈2÷⍨⍵) ⋄ ⍵}⍵ ⋄ x←∇0⊃⍵ ⋄ x≡0⊃⍵:x(∇1⊃⍵) ⋄ x(1⊃⍵)}
reduce←{x←1⊃0 explode ⍵ ⋄ x≡⍵:split x ⋄ x}
{0=≡⍵: ⍵ ⋄ +/3 2×∇¨⍵}⊃{reduce⍣≡⊢⍵ ⍺}/⌽ a
⌈/ {{0=≡⍵: ⍵ ⋄ +/3 2×∇¨⍵} reduce⍣≡⊢ a[⍵]}¨ {(~=/¨⍵)/⍵} ⊃,/↓⍳2⍴(⍴a)
